// Generated by CoffeeScript 1.10.0
(function() {
  var Promise, balance, checker, services;

  Promise = require("bluebird");

  services = require('./services');

  checker = require('./address-checker');

  balance = function(addr, callback) {
    var fn, s;
    return Promise.settle((function() {
      var results;
      results = [];
      for (s in services) {
        fn = services[s];
        results.push(checker[s.toString()](addr) ? fn(addr) : void 0);
      }
      return results;
    })()).timeout(10000).cancellable().map(function(pi) {
      return pi.isFulfilled() && pi.value();
    }).filter(function(item) {
      return !!item;
    }).reduce(function(a, b) {
      return a.concat(b);
    }, []).filter(function(asset) {
      return !asset.address || asset.address === addr;
    }).nodeify(callback);
  };

  module.exports = balance;

}).call(this);
